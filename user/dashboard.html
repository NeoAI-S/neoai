<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>NEO AI 프로세서 - 대시보드</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, #eef2ff, #fefce8);
      color: #111827;
    }
    .shell {
      max-width: 960px;
      margin: 0 auto;
      padding: 22px 16px 32px;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }
    .logo {
      font-weight: 800;
      font-size: 18px;
      letter-spacing: 0.16em;
    }
    .logo span {
      color: #111827;
      font-weight: 900;
      letter-spacing: 0.2em;
    }
    .nav {
      display: flex;
      gap: 8px;
      font-size: 13px;
    }
    .nav button {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid transparent;
      background: transparent;
      cursor: pointer;
      font-size: 13px;
    }
    .nav button.active {
      background: #111827;
      color: #f9fafb;
    }
    .nav button:hover:not(.active) {
      background: rgba(15, 23, 42, 0.04);
    }

    .card {
      border-radius: 18px;
      background: #ffffff;
      box-shadow: 0 16px 40px rgba(148, 163, 184, 0.3);
      padding: 20px 18px 18px;
      margin-bottom: 14px;
      border: 1px solid #e5e7eb;
    }

    .section-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .section-sub {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 12px;
    }

    .value-row {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      margin-top: 10px;
    }
    .value-box {
      flex: 1;
      min-width: 160px;
      padding: 12px 12px;
      border-radius: 14px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }
    .value-label {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 4px;
    }
    .value-main {
      font-size: 16px;
      font-weight: 700;
    }
    .status-pill {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 12px;
    }
    .status-wait {
      background: #fef3c7;
      color: #92400e;
    }
    .status-run {
      background: #dcfce7;
      color: #166534;
    }
    .status-done {
      background: #e5e7eb;
      color: #374151;
    }
    .info-text {
      font-size: 12px;
      color: #6b7280;
      margin-top: 8px;
      line-height: 1.5;
    }

    /* 소개 섹션 */
    .intro-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 18px;
    }
    .intro-badge {
      display: inline-flex;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: #eef2ff;
      color: #4f46e5;
      margin-bottom: 8px;
    }
    .intro-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .intro-text {
      font-size: 13px;
      color: #4b5563;
      line-height: 1.7;
      white-space: pre-line;
    }
    .intro-points {
      font-size: 12px;
      color: #374151;
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .intro-points li {
      margin-bottom: 6px;
    }
    .intro-tag {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      background: #fef3c7;
      font-size: 11px;
      color: #92400e;
      margin-right: 4px;
      margin-top: 4px;
    }

    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="shell">
    <header class="topbar">
      <div class="logo"><span>NEO AI</span> PROCESSOR</div>
      <nav class="nav">
        <!-- 순서: AI 투자현황, 소개, 로그아웃 -->
        <button id="tabStatus" class="active">AI 투자현황</button>
        <button id="tabIntro">소개</button>
        <button id="btnLogout">로그아웃</button>
      </nav>
    </header>

    <!-- AI 투자현황 섹션 -->
    <section id="sectionStatus" class="card">
      <div class="section-title">AI 투자현황</div>
      <div class="section-sub" id="userNameLine"></div>

      <div class="value-row">
        <div class="value-box">
          <div class="value-label">AI투자중인 금액</div>
          <div class="value-main" id="amountText">- 원</div>
        </div>
        <div class="value-box">
          <div class="value-label">진행 상태</div>
          <div id="statusBadge"></div>
        </div>
      </div>

      <div class="info-text" id="approvalInfo"></div>
    </section>

    <!-- 소개 섹션 -->
    <section id="sectionIntro" class="card hidden">
      <div class="intro-badge">AI 기반 자동 투자 프로세스</div>
      <div class="intro-grid">
        <div>
          <div class="intro-title">네오AI, 스스로 판단하고 분산 투자하는 인공지능</div>
          <p class="intro-text">
네오AI는 5년 이상 축적된 데이터와 딥러닝 기반 알고리즘으로
시장 상황을 실시간 분석하고, 여러 종목과 자산군에 자동으로 분산 투자하는
AI 투자 프로세서입니다.

단순 신호 제공이 아니라, 목표 수익·위험 수준에 맞춰
포트폴리오를 설계하고 운용하는 “AI 운용팀”에 가깝게 설계되었습니다.
          </p>
        </div>
        <div>
          <ul class="intro-points">
            <li>· 경제 지표 / 뉴스 / 시황 데이터를 종합 분석</li>
            <li>· 30개 내외 핵심 종목으로 포트폴리오 자동 구성</li>
            <li>· 최소 1시간 ~ 최대 12일 운용 구간 설정</li>
            <li>· 구간별 손익·리스크를 AI가 반복 학습</li>
            <li>· 사용자는 투자 금액과 승인 여부만 관리</li>
          </ul>
          <div style="margin-top:10px;">
            <span class="intro-tag">인공지능 분석</span>
            <span class="intro-tag">포트폴리오 분산</span>
            <span class="intro-tag">AI 리스크 관리</span>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Supabase + 대시보드 로직 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabaseUrl = 'https://uvwturgomovjvokojtkp.supabase.co';
    const supabaseKey = 'sb_publishable_a6k4T2_-ksuHVUvCduUlCQ_DtoR9R4F';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    let currentUser = null;

    function requireLogin() {
      const raw = localStorage.getItem('neoai_current_user');
      if (!raw) {
        alert('로그인이 필요합니다.');
        window.location.href = 'index.html';
        return;
      }
      try {
        currentUser = JSON.parse(raw);
      } catch {
        localStorage.removeItem('neoai_current_user');
        window.location.href = 'index.html';
      }
    }

    function formatAmount(value) {
      if (value == null || isNaN(value)) return '- 원';
      return Number(value).toLocaleString('ko-KR') + ' 원';
    }

    function renderStatus(status) {
      const badge = document.getElementById('statusBadge');
      badge.innerHTML = '';

      const span = document.createElement('span');
      span.classList.add('status-pill');

      if (!status || status === '대기중') {
        span.classList.add('status-wait');
        span.textContent = '대기중';
      } else if (status === '진행중') {
        span.classList.add('status-run');
        span.textContent = '진행중';
      } else {
        span.classList.add('status-done');
        span.textContent = '진행 완료';
      }

      badge.appendChild(span);
    }

    async function loadStatus() {
      const nameLine = document.getElementById('userNameLine');
      const amountText = document.getElementById('amountText');
      const approvalInfo = document.getElementById('approvalInfo');

      nameLine.textContent = `${currentUser.name || currentUser.username}님의 AI 투자 진행 정보입니다.`;

      try {
        const { data, error } = await supabase
          .from('users')
          .select('amount, status, approved')
          .eq('id', currentUser.id)
          .single();

        if (error || !data) {
          console.error(error);
          amountText.textContent = '- 원';
          approvalInfo.textContent = '투자 정보 조회 중 오류가 발생했습니다.';
          return;
        }

        amountText.textContent = formatAmount(data.amount);
        renderStatus(data.status);

        if (!data.approved) {
          approvalInfo.textContent = '현재 관리자 승인 대기 중입니다. 승인 완료 후부터 로그인 및 투자 진행이 가능합니다.';
        } else {
          approvalInfo.textContent = 'AI 투자 진행 현황은 관리자 페이지에서 변경되며, 로그인 시점 기준으로 최신 정보가 반영됩니다.';
        }
      } catch (e) {
        console.error(e);
        approvalInfo.textContent = '서버와 통신 중 오류가 발생했습니다.';
      }
    }

    // 탭 전환
    const tabStatus = document.getElementById('tabStatus');
    const tabIntro = document.getElementById('tabIntro');
    const sectionStatus = document.getElementById('sectionStatus');
    const sectionIntro = document.getElementById('sectionIntro');

    tabStatus.addEventListener('click', () => {
      tabStatus.classList.add('active');
      tabIntro.classList.remove('active');
      sectionStatus.classList.remove('hidden');
      sectionIntro.classList.add('hidden');
    });

    tabIntro.addEventListener('click', () => {
      tabIntro.classList.add('active');
      tabStatus.classList.remove('active');
      sectionIntro.classList.remove('hidden');
      sectionStatus.classList.add('hidden');
    });

    document.getElementById('btnLogout').addEventListener('click', () => {
      localStorage.removeItem('neoai_current_user');
      alert('로그아웃 되었습니다.');
      window.location.href = 'index.html';
    });

    requireLogin();
    loadStatus();
  </script>
</body>
</html>
