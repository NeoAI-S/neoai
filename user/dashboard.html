<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>NEO AI 프로세서 - 대시보드</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }

    /* 눈누 SUIT 웹폰트 */
    @font-face {
      font-family: 'SUIT-Regular';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-Regular.woff2')
           format('woff2');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    body {
      margin: 0;
      font-family: 'SUIT-Regular', -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      color: #e5e7eb;
      background:
        radial-gradient(circle at 0% 0%, rgba(94, 234, 212, 0.25), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(129, 140, 248, 0.4), transparent 55%),
        radial-gradient(circle at 0% 100%, rgba(251, 113, 133, 0.3), transparent 55%),
        linear-gradient(135deg, #020617, #020617);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 18px 12px 28px;
    }

    .shell {
      width: 100%;
      max-width: 960px;
    }

    .frame {
      border-radius: 26px;
      background: rgba(15, 23, 42, 0.83);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border: 1px solid rgba(148, 163, 184, 0.65);
      box-shadow:
        0 28px 80px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(15, 23, 42, 0.8);
      padding: 18px 20px 20px;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .logo {
      font-weight: 800;
      font-size: 18px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: #f9fafb;
    }
    .logo span {
      color: #a5b4fc;
      font-weight: 900;
      letter-spacing: 0.24em;
    }

    .nav {
      display: flex;
      gap: 8px;
      font-size: 13px;
    }
    .nav button {
      padding: 7px 14px;
      border-radius: 999px;
      border: 1px solid transparent;
      background: rgba(15, 23, 42, 0.4);
      color: #e5e7eb;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.16s ease;
    }
    .nav button.active {
      background: #f97316;
      color: #0b1120;
      box-shadow: 0 14px 34px rgba(248, 113, 113, 0.4);
      transform: translateY(-1px);
    }
    .nav button:hover:not(.active) {
      background: rgba(148, 163, 184, 0.16);
    }

    .card {
      border-radius: 20px;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.18), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(251, 113, 133, 0.26), transparent 60%),
                  rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(75, 85, 99, 0.7);
      box-shadow: 0 20px 55px rgba(15, 23, 42, 0.9);
      padding: 18px 18px 18px;
      margin-bottom: 12px;
    }

    .section-title {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 4px;
      color: #f9fafb;
    }

    .section-sub {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 14px;
    }

    .value-row {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      margin-top: 8px;
    }
    .value-box {
      flex: 1;
      min-width: 170px;
      padding: 14px 14px;
      border-radius: 16px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(55, 65, 81, 0.9);
    }
    .value-label {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    .value-main {
      font-size: 20px;
      font-weight: 700;
      color: #e5e7eb;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      padding: 4px 11px;
      border-radius: 999px;
      font-size: 12px;
      gap: 6px;
    }
    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
    }
    .status-wait {
      background: rgba(250, 204, 21, 0.12);
      color: #facc15;
      border: 1px solid rgba(250, 204, 21, 0.5);
    }
    .status-wait .status-dot {
      background: #facc15;
    }
    .status-run {
      background: rgba(52, 211, 153, 0.15);
      color: #4ade80;
      border: 1px solid rgba(34, 197, 94, 0.5);
    }
    .status-run .status-dot {
      background: #22c55e;
    }
    .status-done {
      background: rgba(148, 163, 184, 0.22);
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.6);
    }
    .status-done .status-dot {
      background: #e5e7eb;
    }

    .approved-pill {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      gap: 6px;
    }
    .approved-pill span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
    }
    .approved-yes {
      background: rgba(34, 197, 94, 0.12);
      color: #4ade80;
      border: 1px solid rgba(34, 197, 94, 0.6);
    }
    .approved-yes span.dot { background: #22c55e; }
    .approved-no {
      background: rgba(248, 113, 113, 0.12);
      color: #fecaca;
      border: 1px solid rgba(248, 113, 113, 0.6);
    }
    .approved-no span.dot { background: #f97373; }

    .info-text {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 10px;
      line-height: 1.6;
    }

    /* 진행 단계 카드 */
    .steps-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .step {
      flex: 1;
      min-width: 120px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.88);
      font-size: 12px;
      color: #9ca3af;
      position: relative;
    }
    .step-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #e5e7eb;
    }
    .step.active {
      border-color: #f97316;
      box-shadow: 0 0 0 1px rgba(248, 113, 113, 0.35);
      color: #e5e7eb;
    }
    .step-tag {
      position: absolute;
      top: 8px;
      right: 10px;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.8);
      color: #9ca3af;
    }
    .step.active .step-tag {
      background: #f97316;
      border-color: #fed7aa;
      color: #0b1120;
    }

    /* 소개 섹션 */
    .intro-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 18px;
    }
    @media (max-width: 720px) {
      .intro-grid { grid-template-columns: minmax(0, 1fr); }
    }

    .intro-badge {
      display: inline-flex;
      padding: 4px 11px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(59, 130, 246, 0.18);
      color: #60a5fa;
      margin-bottom: 10px;
    }
    .intro-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 8px;
      color: #f9fafb;
    }
    .intro-text {
      font-size: 13px;
      color: #d1d5db;
      line-height: 1.7;
      white-space: pre-line;
    }
    .intro-points {
      font-size: 12px;
      color: #e5e7eb;
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .intro-points li {
      margin-bottom: 6px;
    }
    .intro-tag {
      display: inline-block;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(236, 72, 153, 0.15);
      border: 1px solid rgba(236, 72, 153, 0.4);
      font-size: 11px;
      color: #f9a8d4;
      margin-right: 4px;
      margin-top: 4px;
    }

    .intro-cols {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 14px;
      font-size: 12px;
    }
    @media (max-width: 720px) {
      .intro-cols { grid-template-columns: minmax(0, 1fr); }
    }
    .intro-box {
      padding: 10px 11px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(75, 85, 99, 0.8);
    }
    .intro-box-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #e5e7eb;
    }

    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="shell">
    <div class="frame">
      <header class="topbar">
        <div class="logo"><span>NEO AI</span> PROCESSOR</div>
        <nav class="nav">
          <!-- 순서: AI 투자현황, 소개, 로그아웃 -->
          <button id="tabStatus" class="active">AI 투자현황</button>
          <button id="tabIntro">소개</button>
          <button id="btnLogout">로그아웃</button>
        </nav>
      </header>

      <!-- AI 투자현황 메인 카드 -->
      <section id="sectionStatus" class="card">
        <div class="section-title">AI 투자현황</div>
        <div class="section-sub" id="nameLine"></div>

        <div class="value-row">
          <div class="value-box">
            <div class="value-label">AI투자중인 금액</div>
            <div class="value-main" id="amountText">- 원</div>
          </div>
          <div class="value-box">
            <div class="value-label">진행 상태</div>
            <div id="statusBadge"></div>
          </div>
          <div class="value-box">
            <div class="value-label">승인 상태</div>
            <div id="approvedBadge"></div>
          </div>
        </div>

        <div class="info-text" id="approvalInfo"></div>
      </section>

      <!-- AI 세션 진행 단계 카드 -->
      <section id="sectionStatusExtra" class="card">
        <div class="section-title">AI 세션 진행 단계</div>
        <div class="section-sub">
          네오AI는 아래 3단계를 거쳐 세션을 운용합니다. 현재 단계는 강조된 카드로 표시됩니다.
        </div>

        <div class="steps-row">
          <div class="step" data-step="wait">
            <div class="step-title">1단계 · 대기중</div>
            <div class="step-tag">READY</div>
            <div>
              관리자 승인과 투자금 확정 전 단계입니다.<br/>
              계좌·금액이 확정되면 다음 단계로 이동합니다.
            </div>
          </div>
          <div class="step" data-step="run">
            <div class="step-title">2단계 · 진행중</div>
            <div class="step-tag">RUNNING</div>
            <div>
              AI가 시장 데이터를 분석해 분산 투자를 실행하는 구간입니다.<br/>
              구간 내에서 포트폴리오가 자동으로 조정됩니다.
            </div>
          </div>
          <div class="step" data-step="done">
            <div class="step-title">3단계 · 진행 완료</div>
            <div class="step-tag">CLOSE</div>
            <div>
              해당 세션의 운용이 종료된 상태입니다.<br/>
              수익·손실 정산 및 다음 세션 준비에 활용됩니다.
            </div>
          </div>
        </div>
      </section>

      <!-- 소개 섹션 -->
      <section id="sectionIntro" class="card hidden">
        <div class="intro-badge">AI 기반 자동 투자 프로세스</div>
        <div class="intro-grid">
          <div>
            <div class="intro-title">네오AI, 스스로 판단하고 분산 투자하는 인공지능</div>
            <p class="intro-text">
네오AI는 대량의 시장 데이터와 딥러닝 알고리즘을 활용해서
시장 흐름을 분석하고, 여러 종목과 자산군에 자동으로 분산 투자하는
AI 투자 프로세서입니다.

사용자는 투자 금액과 기간만 정하면,
AI가 포트폴리오 구성부터 리스크 관리까지 전 과정을 자동으로 수행하도록 설계되어 있습니다.
            </p>

            <div class="intro-cols">
              <div class="intro-box">
                <div class="intro-box-title">AI가 하는 일 3단계</div>
                <ul class="intro-points">
                  <li>1. 시장·뉴스·지표 데이터 스캔</li>
                  <li>2. 포트폴리오 구성 및 분산 투자</li>
                  <li>3. 손익·리스크 모니터링 및 재학습</li>
                </ul>
              </div>
              <div class="intro-box">
                <div class="intro-box-title">이런 분께 잘 맞아요</div>
                <ul class="intro-points">
                  <li>· 단기 구간 단위로 운용하고 싶은 분</li>
                  <li>· 포트폴리오 분산이 번거로운 분</li>
                  <li>· AI 기반 의사결정을 체험해 보고 싶은 분</li>
                </ul>
              </div>
            </div>
          </div>
          <div>
            <div class="intro-box">
              <div class="intro-box-title">운용 기본 원칙</div>
              <ul class="intro-points">
                <li>· 최소 1시간 ~ 최대 12일 단위로 세션 운용</li>
                <li>· 세션마다 목표 수익률·리스크 한도 설정</li>
                <li>· 과거 성과·실시간 데이터를 함께 반영</li>
              </ul>
            </div>

            <div class="intro-box" style="margin-top:10px;">
              <div class="intro-box-title">주의사항</div>
              <ul class="intro-points">
                <li>· AI 투자라고 해서 손실이 아예 없는 것은 아닙니다.</li>
                <li>· 과거 수익률이 미래 수익을 보장하지 않습니다.</li>
                <li>· 세션별 진행상태·금액은 관리자 페이지 기준으로 반영됩니다.</li>
              </ul>
            </div>

            <div style="margin-top:10px;">
              <span class="intro-tag">인공지능 분석</span>
              <span class="intro-tag">포트폴리오 분산</span>
              <span class="intro-tag">AI 리스크 관리</span>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Supabase + 대시보드 로직 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabaseUrl = 'https://uvwturgomovjvokojtkp.supabase.co';
    const supabaseKey = 'sb_publishable_a6k4T2_-ksuHVUvCduUlCQ_DtoR9R4F';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    let currentUser = null;

    function requireLogin() {
      const raw = localStorage.getItem('neoai_current_user');
      if (!raw) {
        alert('로그인이 필요합니다.');
        window.location.href = 'index.html';
        return;
      }
      try {
        currentUser = JSON.parse(raw);
      } catch {
        localStorage.removeItem('neoai_current_user');
        window.location.href = 'index.html';
      }
    }

    function formatAmount(value) {
      if (value == null || isNaN(value)) return '- 원';
      return Number(value).toLocaleString('ko-KR') + ' 원';
    }

    function renderStatus(status) {
      const badge = document.getElementById('statusBadge');
      badge.innerHTML = '';

      const wrapper = document.createElement('span');
      wrapper.classList.add('status-pill');
      const dot = document.createElement('span');
      dot.classList.add('status-dot');
      const text = document.createElement('span');

      if (!status || status === '대기중') {
        wrapper.classList.add('status-wait');
        text.textContent = '대기중';
      } else if (status === '진행중') {
        wrapper.classList.add('status-run');
        text.textContent = '진행중';
      } else {
        wrapper.classList.add('status-done');
        text.textContent = '진행 완료';
      }

      wrapper.appendChild(dot);
      wrapper.appendChild(text);
      badge.appendChild(wrapper);
    }

    function renderApproved(approved) {
      const box = document.getElementById('approvedBadge');
      box.innerHTML = '';

      const pill = document.createElement('span');
      pill.classList.add('approved-pill');
      const dot = document.createElement('span');
      dot.classList.add('dot');
      const text = document.createElement('span');

      if (approved) {
        pill.classList.add('approved-yes');
        text.textContent = '승인 완료';
      } else {
        pill.classList.add('approved-no');
        text.textContent = '승인 대기';
      }

      pill.appendChild(dot);
      pill.appendChild(text);
      box.appendChild(pill);
    }

    function renderSteps(status) {
      const steps = document.querySelectorAll('.step');
      steps.forEach(step => step.classList.remove('active'));

      let key = 'wait';
      if (status === '진행중') key = 'run';
      else if (status === '진행 완료') key = 'done';

      const target = document.querySelector(`.step[data-step="${key}"]`);
      if (target) target.classList.add('active');
    }

    async function loadStatus() {
      const amountText = document.getElementById('amountText');
      const approvalInfo = document.getElementById('approvalInfo');
      const nameLine = document.getElementById('nameLine');

      const displayName = (currentUser && (currentUser.name || currentUser.username)) || '';
      if (displayName) {
        nameLine.textContent = `${displayName}님의 AI 투자 진행 정보입니다.`;
      } else {
        nameLine.textContent = 'AI 투자 진행 정보입니다.';
      }

      try {
        const { data, error } = await supabase
          .from('users')
          .select('amount, status, approved, name, username')
          .eq('username', currentUser.username)
          .maybeSingle();

        if (error) {
          console.error('Supabase error:', error);
          amountText.textContent = '- 원';
          approvalInfo.textContent = '투자 정보 조회 중 오류가 발생했습니다.';
          renderStatus('대기중');
          renderApproved(false);
          renderSteps('대기중');
          return;
        }

        if (!data) {
          amountText.textContent = '- 원';
          approvalInfo.textContent = '등록된 투자 정보가 없습니다.';
          renderStatus('대기중');
          renderApproved(false);
          renderSteps('대기중');
          return;
        }

        amountText.textContent = formatAmount(data.amount);
        renderStatus(data.status);
        renderApproved(data.approved);
        renderSteps(data.status);

        if (!data.approved) {
          approvalInfo.textContent =
            `${displayName ? displayName + '님은 ' : ''}현재 관리자 승인 대기 중입니다. 승인 완료 후부터 AI 투자 진행이 시작됩니다.`;
        } else {
          approvalInfo.textContent =
            `${displayName ? displayName + '님의 ' : ''}AI 투자 진행 상황은 관리자에서 변경되며, 로그인 시점 기준으로 최신 상태가 반영됩니다.`;
        }
      } catch (e) {
        console.error('JS error:', e);
        amountText.textContent = '- 원';
        approvalInfo.textContent = '투자 정보 조회 중 오류가 발생했습니다.';
        renderStatus('대기중');
        renderApproved(false);
        renderSteps('대기중');
      }
    }

    // 탭 전환
    const tabStatus = document.getElementById('tabStatus');
    const tabIntro = document.getElementById('tabIntro');
    const sectionStatus = document.getElementById('sectionStatus');
    const sectionStatusExtra = document.getElementById('sectionStatusExtra');
    const sectionIntro = document.getElementById('sectionIntro');

    tabStatus.addEventListener('click', () => {
      tabStatus.classList.add('active');
      tabIntro.classList.remove('active');
      sectionStatus.classList.remove('hidden');
      sectionStatusExtra.classList.remove('hidden');
      sectionIntro.classList.add('hidden');
    });

    tabIntro.addEventListener('click', () => {
      tabIntro.classList.add('active');
      tabStatus.classList.remove('active');
      sectionIntro.classList.remove('hidden');
      sectionStatus.classList.add('hidden');
      sectionStatusExtra.classList.add('hidden');
    });

    document.getElementById('btnLogout').addEventListener('click', () => {
      localStorage.removeItem('neoai_current_user');
      alert('로그아웃 되었습니다.');
      window.location.href = 'index.html';
    });

    requireLogin();
    loadStatus();
  </script>
</body>
</html>
